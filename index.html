<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';"><meta http-equiv="X-Content-Type-Options" content="nosniff"><meta http-equiv="Referrer-Policy" content="no-referrer"><meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()"><meta name="theme-color" content="#000000"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Lemonade"><link rel="icon" href="icon.svg"><link rel="apple-touch-icon" href="icon.svg"><link rel="manifest" href="manifest.json"><title>Lemonade</title><style>:root{--bg-color:#ffffff;--text-color:#000000;--title-gradient:linear-gradient(90deg, #000000, #000000);--card-bg:#ffffff;--accent-color:#000000;--border-color:#dddddd;--input-bg:#ffffff;--button-bg:#000000;--button-text:#ffffff;--button-hover:#333333;--success-color:#00cc66;--error-color:#cc3300;--warning-color:#f0ad4e;--cyber-line:rgba(0, 0, 0, 0.15);--cyber-glow:rgba(0, 0, 0, 0.4);--security-high:#00cc66;--security-medium:#f0ad4e;--security-low:#cc3300;--output-bg:#f8f8f8;--output-text:#222222}body.dark-mode{--bg-color:#000000;--text-color:#ffffff;--title-gradient:linear-gradient(90deg, #FF00FF, #00FFFF, #FFFF00);--card-bg:rgba(18, 18, 18, 0.7);--accent-color:#FF00FF;--border-color:#333333;--input-bg:rgba(26, 26, 26, 0.7);--button-bg:#00FFFF;--button-text:#000000;--button-hover:#FF00FF;--success-color:#39FF14;--error-color:#FF3131;--warning-color:#FFFF00;--cyber-line:rgba(0, 255, 255, 0.4);--cyber-glow:rgba(255, 0, 255, 0.6);--security-high:#39FF14;--security-medium:#FFFF00;--security-low:#FF3131;--output-bg:rgba(10, 10, 15, 0.7);--output-text:#e0e0ff}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--bg-color);color:var(--text-color);margin:0;padding:0;transition:background-color .3s,color .3s;line-height:1.6;position:relative;overflow-x:hidden}body::before{display:none}body.dark-mode::before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:linear-gradient(125deg,#000,#203,#003,#303,#002);background-size:400% 400%;animation:gradient-shift 15s ease infinite;opacity:.9}@keyframes gradient-shift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}body.dark-mode::after{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;background:repeating-linear-gradient(0deg,rgba(0,0,0,.15),rgba(0,0,0,.15) 1px,transparent 1px,transparent 2px);pointer-events:none}body.dark-mode .app-title{background:var(--title-gradient);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 15px var(--cyber-glow);animation:title-shift 5s ease infinite}@keyframes title-shift{0%{filter:hue-rotate(0)}50%{filter:hue-rotate(90deg)}100%{filter:hue-rotate(0)}}body.dark-mode .card{border:1px solid var(--accent-color);box-shadow:0 0 15px rgba(255,0,255,.5);backdrop-filter:blur(5px);animation:border-pulse 4s infinite}@keyframes border-pulse{0%{border-color:#f0f;box-shadow:0 0 15px rgba(255,0,255,.5)}33%{border-color:#0ff;box-shadow:0 0 15px rgba(0,255,255,.5)}66%{border-color:#ff0;box-shadow:0 0 15px rgba(255,255,0,.5)}100%{border-color:#f0f;box-shadow:0 0 15px rgba(255,0,255,.5)}}body.dark-mode button{border:1px solid transparent;box-shadow:0 0 10px var(--cyber-glow);text-shadow:0 0 5px rgba(0,0,0,.5);transition:all .3s ease;position:relative;overflow:hidden}body.dark-mode button:hover{box-shadow:0 0 20px var(--cyber-glow);transform:translateY(-2px)}body.dark-mode button::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(#f0f,#0ff,#ff0,#f0f);animation:rotate 3s linear infinite;opacity:0;transition:opacity .3s;z-index:-1}body.dark-mode button:hover::before{opacity:.3}@keyframes rotate{from{transform:rotate(0)}to{transform:rotate(360deg)}}body.dark-mode input,body.dark-mode select,body.dark-mode textarea{border:1px solid var(--border-color);box-shadow:inset 0 0 10px rgba(0,0,0,.5);backdrop-filter:blur(5px);transition:all .3s ease}body.dark-mode input:focus,body.dark-mode select:focus,body.dark-mode textarea:focus{border-color:var(--accent-color);box-shadow:0 0 15px var(--cyber-glow),inset 0 0 10px rgba(0,0,0,.5);animation:focus-pulse 2s infinite}@keyframes focus-pulse{0%{border-color:#f0f}50%{border-color:#0ff}100%{border-color:#f0f}}body.dark-mode .security-badge{animation:security-pulse 2s infinite;text-shadow:0 0 5px currentColor}@keyframes security-pulse{0%{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 15px currentColor}100%{box-shadow:0 0 5px currentColor}}body.dark-mode .key-item{border:1px solid var(--border-color);background:linear-gradient(145deg,rgba(18,18,18,.7),rgba(26,26,26,.7));box-shadow:0 0 10px rgba(0,0,0,.5);transition:all .3s ease}body.dark-mode .key-item:hover{transform:translateY(-2px);box-shadow:0 0 15px rgba(255,0,255,.3)}body.dark-mode .tab-btn.active{background:linear-gradient(90deg,rgba(0,0,0,.5),rgba(255,0,255,.1),rgba(0,0,0,.5));box-shadow:0 0 10px rgba(255,0,255,.3);animation:tab-shift 3s infinite}@keyframes tab-shift{0%{border-color:#f0f}33%{border-color:#0ff}66%{border-color:#ff0}100%{border-color:#f0f}}body.dark-mode .slider{background:linear-gradient(90deg,#203,#003);box-shadow:inset 0 0 5px rgba(0,0,0,.5)}body.dark-mode input:checked+.slider{background:linear-gradient(90deg,#0ff,#f0f)}body.dark-mode .slider:before{box-shadow:0 0 5px rgba(255,255,255,.5)}body.dark-mode .status.error,body.dark-mode .status.success,body.dark-mode .status.warning{animation:status-pulse 2s infinite}@keyframes status-pulse{0%{box-shadow:inset 0 0 10px rgba(0,0,0,.3)}50%{box-shadow:inset 0 0 20px rgba(0,0,0,.5)}100%{box-shadow:inset 0 0 10px rgba(0,0,0,.3)}}body.dark-mode .spinner{border:5px solid rgba(0,0,0,.3);border-top-color:var(--accent-color);animation:spin 1s ease-in-out infinite,color-shift 3s linear infinite}@keyframes color-shift{0%{border-top-color:#f0f}33%{border-top-color:#0ff}66%{border-top-color:#ff0}100%{border-top-color:#f0f}}.container{max-width:600px;margin:0 auto;padding:20px;transition:max-width .3s ease-in-out}.app-header{text-align:center;margin-bottom:20px;position:relative}.app-title{font-size:1.8rem;margin:0;background:var(--title-gradient);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 15px var(--cyber-glow)}.app-subtitle{font-size:.9rem;margin:0;padding-top:2px;font-style:italic;color:var(--text-color);opacity:.8}.app-header::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:80%;height:2px;background:linear-gradient(90deg,transparent,var(--accent-color),transparent)}.card{background-color:var(--card-bg);border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:20px;margin-bottom:20px;border:1px solid var(--border-color);position:relative;overflow:hidden}.card::before{content:'';position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,#3af,#06c)}.tabs{display:flex;justify-content:center;margin-bottom:20px;border-bottom:1px solid var(--border-color);overflow-x:auto}.tab-btn{background:0 0;border:none;padding:10px 20px;font-size:1rem;cursor:pointer;color:var(--text-color);border-bottom:2px solid transparent;transition:all .3s;position:relative;overflow:hidden;white-space:nowrap}.tab-btn.active{border-bottom:2px solid var(--accent-color);color:var(--accent-color)}.tab-btn::after{content:'';position:absolute;bottom:0;left:0;width:0;height:2px;background-color:var(--accent-color);transition:width .3s}.tab-btn:hover::after{width:100%}.tab-content{display:none!important}.tab-content.active{display:block!important;animation:fadeIn .3s ease-in-out}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.form-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:500}input,select,textarea{width:100%;padding:12px;border:1px solid var(--border-color);border-radius:8px;background-color:var(--input-bg);color:var(--text-color);font-size:1rem;box-sizing:border-box;transition:border-color .3s,box-shadow .3s}input:focus,select:focus,textarea:focus{outline:0;border-color:var(--accent-color);box-shadow:0 0 0 2px var(--cyber-glow)}#decryptedOutput,#encryptedOutput{min-height:120px;background-color:var(--output-bg);color:var(--output-text);border-width:1px;border-style:solid;border-color:var(--border-color);font-family:Consolas,'Courier New',monospace;width:100%;resize:vertical;padding:15px;overflow-y:auto}.form-group:has(#decryptedOutput),.form-group:has(#encryptedOutput){width:100%}#decrypt .form-group:nth-of-type(3),#encrypt .form-group:nth-of-type(3){width:100%}textarea{min-height:100px;resize:vertical}button{background-color:var(--button-bg);color:var(--button-text);border:none;border-radius:8px;padding:12px 20px;font-size:1rem;cursor:pointer;transition:background-color .3s,transform .1s;position:relative;overflow:hidden}button:hover{background-color:var(--button-hover)}button:active{transform:scale(.98)}button::after{content:'';position:absolute;top:50%;left:50%;width:5px;height:5px;background:rgba(255,255,255,.5);opacity:0;border-radius:100%;transform:scale(1,1) translate(-50%);transform-origin:50% 50%}button:focus:not(:active)::after{animation:ripple 1s ease-out}@keyframes ripple{0%{transform:scale(0,0);opacity:.5}100%{transform:scale(20,20);opacity:0}}.btn-group{display:flex;gap:10px;margin-top:15px}.btn-secondary{background-color:transparent;border:1px solid var(--accent-color);color:var(--accent-color)}.btn-secondary:hover{background-color:rgba(51,170,255,.1)}.status{padding:10px;border-radius:8px;margin-top:15px;display:none}.status.success{background-color:rgba(0,204,102,.1);color:var(--success-color);border:1px solid var(--success-color);display:block}.status.warning{background-color:rgba(240,173,78,.1);color:var(--warning-color);border:1px solid var(--warning-color);display:block}.status.error{background-color:rgba(204,51,0,.1);color:var(--error-color);border:1px solid var(--error-color);display:block}.keys-container{display:flex;flex-direction:column;gap:20px}.keys-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:15px;width:100%}.key-form{display:flex;flex-direction:column;gap:15px}.key-item{background-color:var(--input-bg);border:1px solid var(--border-color);border-radius:8px;padding:15px;display:flex;flex-direction:column;height:100%}.key-item-content{flex:1;display:flex;flex-direction:column}.key-item h3{margin-top:0;margin-bottom:10px}.key-header{text-align:center;margin-bottom:15px}.key-actions{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:auto;padding-top:15px;border-top:1px solid var(--border-color)}.key-actions button{flex:1 1 auto;min-width:80px;padding:8px 12px;font-size:.9rem}.key-meta{font-size:.9rem;color:#888;margin-bottom:5px}.key-management-buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}.key-management-buttons button{flex:1 1 auto;min-width:100px}.btn-zero{background-color:#c30;color:#fff;margin-top:20px;width:100%;font-weight:700;border:1px solid #a20}.btn-zero:hover{background-color:#f30}body.dark-mode .btn-zero{background-color:#ff3131;color:#fff;border:1px solid #c00}body.dark-mode .btn-zero:hover{background-color:#f55}.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000;display:none}.spinner{width:50px;height:50px;border:5px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:var(--accent-color);animation:spin 1s ease-in-out infinite}@keyframes spin{to{transform:rotate(360deg)}}.password-strength{height:5px;border-radius:5px;margin-top:5px;transition:all .3s}.password-strength.weak{background-color:var(--security-low);width:30%}.password-strength.medium{background-color:var(--security-medium);width:60%}.password-strength.strong{background-color:var(--security-high);width:100%}.password-feedback{font-size:.8rem;margin-top:5px}.security-badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:12px;font-size:.8rem;margin-left:8px;font-weight:700}.security-badge.high{background-color:rgba(0,204,102,.1);color:var(--security-high);border:1px solid var(--security-high)}.security-badge.medium{background-color:rgba(240,173,78,.1);color:var(--security-medium);border:1px solid var(--security-medium)}.security-badge.low{background-color:rgba(204,51,0,.1);color:var(--security-low);border:1px solid var(--security-low)}@keyframes securityPulse{0%{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 15px currentColor}100%{box-shadow:0 0 5px currentColor}}body.dark-mode .security-badge{animation:securityPulse 2s infinite;transition:all .3s ease}body.dark-mode .security-badge.high{box-shadow:0 0 5px var(--security-high)}body.dark-mode .security-badge.medium{box-shadow:0 0 5px var(--security-medium)}body.dark-mode .security-badge.low{box-shadow:0 0 5px var(--security-low)}.key-pair-badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:12px;font-size:.8rem;font-weight:700;margin-top:5px}.key-pair-badge.full{background-color:rgba(0,204,102,.1);color:var(--security-high);border:1px solid var(--security-high)}.key-pair-badge.private{background-color:rgba(204,51,0,.1);color:var(--security-low);border:1px solid var(--security-low)}.key-pair-badge.public{background-color:rgba(240,173,78,.1);color:var(--security-medium);border:1px solid var(--security-medium)}.private-key-btn{border:1px solid var(--error-color)!important;color:var(--error-color)!important}.private-key-btn:hover{background-color:rgba(204,51,0,.1)!important}body.dark-mode .key-pair-badge.full{box-shadow:0 0 5px var(--security-high)}body.dark-mode .key-pair-badge.private{box-shadow:0 0 5px var(--security-low)}body.dark-mode .key-pair-badge.public{box-shadow:0 0 5px var(--security-medium)}body.dark-mode .private-key-btn{border:1px solid var(--error-color)!important;color:var(--error-color)!important}body.dark-mode .private-key-btn:hover{background-color:rgba(255,49,49,.2)!important}.config-toggle{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.config-toggle label{display:inline;margin-bottom:0}.switch{position:relative;display:inline-block;width:50px;height:24px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:24px}.slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--accent-color)}input:focus+.slider{box-shadow:0 0 1px var(--accent-color)}input:checked+.slider:before{transform:translateX(26px)}.security-info{font-size:.9rem;padding:10px;border-left:3px solid var(--accent-color);background-color:rgba(51,170,255,.05);margin-bottom:15px}.key-expiry{font-size:.8rem;color:var(--warning-color);margin-top:5px;font-style:italic}#inactivityModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);z-index:1001;justify-content:center;align-items:center}.modal-content{background-color:var(--card-bg);padding:20px;border-radius:12px;max-width:400px;text-align:center}.timer{font-size:2rem;margin:20px 0;color:var(--warning-color)}#settings{display:none}.settings-section{margin-bottom:20px}.settings-section h3{margin-top:0;border-bottom:1px solid var(--border-color);padding-bottom:5px}.file-info{margin-top:10px;font-size:.9rem;background-color:var(--input-bg);padding:8px;border-radius:4px;display:flex;align-items:center;justify-content:space-between}.file-info-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-icon{margin-right:8px;font-size:1.2rem}.remove-file{cursor:pointer;color:var(--error-color);padding:2px 6px;border-radius:4px;margin-left:8px}.remove-file:hover{background-color:rgba(204,51,0,.1)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);z-index:1001;justify-content:center;align-items:center}.modal-content{background-color:var(--card-bg);padding:20px;border-radius:12px;max-width:400px;width:90%;box-shadow:0 5px 15px rgba(0,0,0,.3);position:relative}body.dark-mode .modal-content{border:1px solid var(--accent-color);box-shadow:0 0 15px rgba(255,0,255,.5)}.btn-primary{background-color:var(--accent-color);color:var(--button-text);border:none;border-radius:8px;padding:12px 20px;font-size:1rem;cursor:pointer;transition:background-color .3s,transform .1s}.btn-primary:hover{background-color:var(--button-hover)}@media (max-width:600px){.container{padding:15px}.card{padding:15px}.app-title{font-size:1.5rem}.btn-group{flex-direction:column}button{width:100%}.tab-btn{padding:10px 10px;font-size:.9rem}.key-actions{flex-direction:column}.key-actions button{width:100%;margin-bottom:5px}}@media (max-width:767px){.keys-container{flex-direction:column}.key-form,.keys-list-container{width:100%}}@media (min-width:768px){.container{max-width:750px}.app-title{font-size:2rem}.card{padding:25px}#decryptedOutput,#encryptedOutput{min-height:150px;font-size:1.05rem}.keys-container{flex-direction:row;align-items:flex-start}.key-form{width:40%;position:sticky;top:20px}.keys-list-container{width:60%}.key-item h3{font-size:1.1rem;margin-top:0;margin-bottom:10px;word-break:break-word}}@media (min-width:1024px){.container{max-width:900px}#decryptedOutput,#encryptedOutput{min-height:180px;font-size:1.1rem;padding:18px}#keys .card{display:flex;flex-wrap:wrap;gap:20px}#keys .card>.security-info,#keys .card>h2{width:100%}#keys .card>.form-group,#keys .card>button#generateKeyBtn{width:calc(40% - 10px)}#keys .card>div:has(#keysList){width:calc(60% - 10px);margin-top:0}#keys .card>div:nth-last-child(3){width:calc(60% - 10px);margin-top:0}#keys .card>.btn-group,#keys .card>div:has(#zeroKeysBtn){width:100%}#decrypt .card,#encrypt .card{display:grid;grid-template-columns:1fr 1fr;gap:20px}#decrypt .card>.form-group:first-child,#decrypt .card>.form-group:has(#decryptedOutput),#decrypt .card>.form-group:nth-child(3),#encrypt .card>.form-group:first-child,#encrypt .card>.form-group:has(#encryptedOutput),#encrypt .card>.form-group:nth-child(3){grid-column:1/span 2}#decrypt .card>button,#encrypt .card>button{grid-column:1/span 2}#decrypt .card>.btn-group,#encrypt .card>.btn-group{grid-column:1/span 2}#decrypt .card>#decryptStatus,#encrypt .card>#encryptStatus{grid-column:1/span 2}}@media (min-width:1200px){.container{max-width:1140px}.keys-grid{grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}}@media (min-width:1440px){.container{max-width:1200px}#decryptedOutput,#encryptedOutput{min-height:220px;font-size:1.15rem;padding:20px}#settings .card{display:grid;grid-template-columns:1fr 1fr;gap:30px}#settings .card>h2{grid-column:1/span 2}#settings .card>.btn-group{grid-column:1/span 2;justify-content:center}#settings .card>#settingsStatus{grid-column:1/span 2}#keysList{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}@media (min-width:1800px){#decrypt .card,#encrypt .card{grid-template-columns:1fr 1fr 1fr}#decrypt .card>#decryptStatus,#decrypt .card>.btn-group,#decrypt .card>.form-group:first-child,#decrypt .card>.form-group:has(#decryptedOutput),#decrypt .card>.form-group:nth-child(3),#decrypt .card>button,#encrypt .card>#encryptStatus,#encrypt .card>.btn-group,#encrypt .card>.form-group:first-child,#encrypt .card>.form-group:has(#encryptedOutput),#encrypt .card>.form-group:nth-child(3),#encrypt .card>button{grid-column:1/span 3}}}@media (max-width:600px){.btn-group{flex-direction:column}button{width:100%}}@media (min-width:601px){.btn-group{flex-direction:row}.btn-group button{flex:1}}@media print{body{background-color:#fff;color:#000}.card{box-shadow:none;border:1px solid #ddd}.app-subtitle,.btn-group,.tabs,button{display:none!important}.container{max-width:100%;padding:0}#decryptedOutput,#encryptedOutput{border:1px solid #ddd;background-color:#fff;color:#000;min-height:auto}}</style></head><body><div class="container"><div class="app-header"><h1 class="app-title">Lemonade</h1><div class="app-subtitle">by elkmire</div><p>The offline security method</p></div><div class="tabs"><button class="tab-btn active" data-tab="encrypt">Encrypt</button> <button class="tab-btn" data-tab="decrypt">Decrypt</button> <button class="tab-btn" data-tab="keys">Key Management</button> <button class="tab-btn" data-tab="settings">Settings</button></div><div class="tab-content active" id="encrypt"><div class="card"><div class="form-group"><label for="encryptMessage">To Encrypt</label> <textarea id="encryptMessage" placeholder="Free-type here or load file for encryption..."></textarea><div style="display:flex;gap:10px;margin-top:5px"><button id="encryptBrowseBtn" class="btn-secondary">Browse Files</button> <button id="clearEncryptMessageBtn" class="btn-secondary">Clear</button> <input type="file" id="encryptFileInput" style="display:none"></div><div id="encryptFileInfo" style="display:none" class="file-info"><span><span class="file-icon">📄</span> <span id="encryptFileName" class="file-info-name"></span></span> <span class="remove-file" id="removeEncryptFile">×</span></div></div><div class="form-group"><label for="encryptionKey">Encryption Key</label> <select id="encryptionKey"><option value="">Select a key...</option></select></div><div class="form-group" id="encryptionPasswordGroup" style="display:none"><label for="encryptionPassword">Key Password</label> <input type="password" id="encryptionPassword" placeholder="Enter key password"></div><button id="encryptBtn">Encrypt Data</button><div class="form-group" style="margin-top:20px"><label for="encryptedOutput">Encrypted Data</label> <textarea id="encryptedOutput" readonly="readonly"></textarea></div><div class="btn-group"><button id="downloadEncryptedBtn" class="btn-secondary">Download Encrypted File</button> <button id="copyEncryptedBtn" class="btn-secondary">Copy to Clipboard</button> <button id="clearEncryptBtn" class="btn-secondary">Clear All</button></div><div id="encryptStatus" class="status"></div></div></div><div class="tab-content" id="decrypt"><div class="card"><div class="form-group"><label for="encryptedMessage">To Decrypt</label> <textarea id="encryptedMessage" placeholder="Paste the encrypted data here or load encrypted data..."></textarea><div style="display:flex;gap:10px;margin-top:5px"><button id="decryptBrowseBtn" class="btn-secondary">Browse Files</button> <button id="clearEncryptedMessageBtn" class="btn-secondary">Clear</button> <input type="file" id="decryptFileInput" style="display:none"></div><div id="decryptFileInfo" style="display:none" class="file-info"><span><span class="file-icon">📄</span> <span id="decryptFileName" class="file-info-name"></span></span> <span class="remove-file" id="removeDecryptFile">×</span></div></div><div class="form-group"><label for="decryptionKey">Decryption Key</label> <select id="decryptionKey"><option value="">Select a key...</option></select></div><div class="form-group" id="decryptionPasswordGroup" style="display:none"><label for="decryptionPassword">Key Password</label> <input type="password" id="decryptionPassword" placeholder="Enter key password"></div><button id="decryptBtn">Decrypt Data</button><div class="form-group" style="margin-top:20px"><label for="decryptedOutput">Decrypted Data</label> <textarea id="decryptedOutput" readonly="readonly"></textarea></div><div class="btn-group"><button id="downloadDecryptedBtn" class="btn-secondary">Download Decrypted File</button> <button id="copyDecryptedBtn" class="btn-secondary">Copy to Clipboard</button> <button id="clearDecryptBtn" class="btn-secondary">Clear All</button></div><div id="decryptStatus" class="status"></div></div></div><div class="tab-content" id="keys"><div class="card"><h2>Key Management</h2><div class="security-info"><strong>Security Note:</strong> All keys are stored locally in your browser's protected storage and never sent to any server.</div><div class="keys-container"><div class="key-form"><div class="form-group"><label for="keyName">Key Name</label> <input id="keyName" placeholder="e.g., enter crypto name"></div><div class="form-group"><label for="keyType">Key Type</label> <select id="keyType"><option value="aes">AES-GCM (Symmetric) - 256 bits</option><option value="rsa">RSA-OAEP (Asymmetric) - 2048 bits</option><option value="rsa-4096">RSA-OAEP (Asymmetric) - 4096 bits</option><option value="ecc">ECC (Asymmetric) - P-256</option><option value="ecc-p384">ECC (Asymmetric) - P-384</option></select></div><div class="form-group"><label for="keyExpiry">Key Expiration (Optional)</label> <select id="keyExpiry"><option value="">Never (Not Recommended)</option><option value="30">30 Days</option><option value="90">90 Days</option><option value="180">180 Days</option><option value="365">1 Year</option></select></div><div class="form-group" id="keyPasswordGroup"><label for="keyPassword">Key Password (Recommended)</label> <input type="password" id="keyPassword" placeholder="Enter optional password"><div id="passwordStrength" class="password-strength"></div><div id="passwordFeedback" class="password-feedback"></div></div><div class="form-group" id="confirmKeyPasswordGroup"><label for="confirmKeyPassword">Confirm Password</label> <input type="password" id="confirmKeyPassword" placeholder="Confirm your password"></div><button id="generateKeyBtn">Generate New Key</button><div class="key-management-buttons"><button id="importKeyBtn" class="btn-secondary">Import Key</button> <button id="exportAllKeysBtn" class="btn-secondary">Export State</button> <button id="importStateBtn" class="btn-secondary">Import State</button></div><div style="text-align:center;margin-top:20px"><button id="zeroKeysBtn" class="btn-zero">ZERO ALL KEYS</button></div><div id="keyStatus" class="status"></div></div><div class="keys-list-container"><h3>Your Keys</h3><div id="keysList" class="keys-grid"></div></div></div></div></div><div class="tab-content" id="settings"><div class="card"><h2>Security Settings</h2><p>(Must SAVE for changes to take effect)</p><p></p><div class="settings-section"><h3>Storage Options</h3><div class="config-toggle"><label for="useIndexedDB">Use IndexedDB for key storage (more secure)</label> <label class="switch"><input type="checkbox" id="useIndexedDB" checked="checked"> <span class="slider"></span></label></div><div class="config-toggle"><label for="sessionOnly">Session-only mode (keys aren't saved when browser closes)</label> <label class="switch"><input type="checkbox" id="sessionOnly"> <span class="slider"></span></label></div></div><div class="settings-section"><h3>Security Parameters</h3><div class="config-toggle"><label for="enforcePwdProtection">Enforce password protection for keys</label> <label class="switch"><input type="checkbox" id="enforcePwdProtection"> <span class="slider"></span></label></div><div class="config-toggle"><label for="enforceKeyExpiry">Enforce key expiration</label> <label class="switch"><input type="checkbox" id="enforceKeyExpiry"> <span class="slider"></span></label></div><div class="form-group"><label for="pbkdf2Iterations">PBKDF2 Iterations (higher = more secure but slower)</label> <select id="pbkdf2Iterations"><option value="100000">100,000 (Default)</option><option value="200000">200,000</option><option value="300000">300,000</option><option value="500000">500,000</option></select></div></div><div class="settings-section"><h3>Appearance</h3><div class="config-toggle"><label for="darkMode">Dark Mode</label> <label class="switch"><input type="checkbox" id="darkMode"> <span class="slider"></span></label></div></div><div class="settings-section"><h3>Install App</h3><p>Installs PWA (must be Chromium-based browser or Safari for IOS)</p><div id="installContainer"><button id="installBtn" class="btn-secondary">Install Lemonade App</button><p class="install-note" style="margin-top:8px;font-size:.85rem;color:#888">(Button will be enabled when installation is available)</p></div><div id="installStatus" class="status"></div></div><div class="btn-group"><button id="saveSettingsBtn">Save Settings</button> <button id="resetSettingsBtn" class="btn-secondary">Reset to Defaults</button></div><div id="settingsStatus" class="status"></div></div></div></div><div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div></div><script>let PBKDF2_CONFIG={ITERATIONS:1e5,HASH:"SHA-256"},AES_CONFIG={KEY_LENGTH:256,MODE:"AES-GCM",IV_LENGTH:12,TAG_LENGTH:128},RSA_CONFIG={KEY_SIZE:2048,KEY_SIZE_4096:4096,ALGORITHM:"RSA-OAEP",HASH:"SHA-256"},ECC_CONFIG={CURVE:"P-256",CURVE_P384:"P-384",ALGORITHM:"ECDH",KEY_DERIVATION:"HKDF",KDF_HASH:"SHA-256",ENC_ALGORITHM:"AES-GCM"},DB_NAME="LemonadeSecureDB",DB_VERSION=1,KEYS_STORE="keys",SETTINGS_STORE="settings",DEFAULT_SETTINGS={useIndexedDB:!0,sessionOnly:!1,enforcePwdProtection:!1,enforceKeyExpiry:!1,pbkdf2Iterations:1e5},db=null,keys=[],appSettings={...DEFAULT_SETTINGS},tabBtns=document.querySelectorAll(".tab-btn"),tabContents=document.querySelectorAll(".tab-content"),encryptionKeySelect=document.getElementById("encryptionKey"),decryptionKeySelect=document.getElementById("decryptionKey"),keysList=document.getElementById("keysList"),loadingOverlay=document.getElementById("loadingOverlay"),inactivityModal=document.getElementById("inactivityModal"),timeoutTimer=document.getElementById("timeoutTimer"),safeMemory={sensitiveData:new WeakMap,store:function(e){var t={id:crypto.randomUUID()};return this.sensitiveData.set(t,e),t},retrieve:function(e,t=!1){var a;return this.sensitiveData.has(e)?(a=this.sensitiveData.get(e),t&&this.sensitiveData.delete(e),a):null},delete:function(e){return!!this.sensitiveData.has(e)&&(this.sensitiveData.delete(e),!0)},clearAll:function(){if(this.sensitiveData=new WeakMap,"function"==typeof window.gc)try{window.gc()}catch(e){console.log("Manual garbage collection not available")}}},validator={sanitizeHTML:function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML},validateInput:function(e,t=!1){return null==e?"":(e=String(e),t?e:this.sanitizeHTML(e))},isValidKeyName:function(e){return/^[A-Za-z0-9 ._-]{1,50}$/.test(e)},isValidEncryptedMessage:function(e){return/^--LM--\s*[A-Za-z0-9+/=]+\s*--EM--$/s.test(e)},measurePasswordStrength:function(e){let t=0;if(!e)return{score:0,feedback:"Password is required"};var a=e.length;t+=Math.min(5,Math.floor(a/4)),/[a-z]/.test(e)&&(t+=1),/[A-Z]/.test(e)&&(t+=1),/[0-9]/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=2),/^[a-zA-Z]+$/.test(e)&&--t,/^[0-9]+$/.test(e)&&--t,/(.)\1{2,}/.test(e)&&--t;let r,n;return n=t<4?(r="weak","Weak - Use a longer password with numbers and special characters"):t<8?(r="medium","Medium - Add more variety or length for better security"):(r="strong","Strong - Good password!"),{score:t,strengthCategory:r,feedback:n}}};async function initDatabase(){if(window.indexedDB)return new Promise((t,e)=>{var a=indexedDB.open(DB_NAME,DB_VERSION);a.onupgradeneeded=function(e){e=e.target.result;e.objectStoreNames.contains(KEYS_STORE)||e.createObjectStore(KEYS_STORE,{keyPath:"id"}),e.objectStoreNames.contains(SETTINGS_STORE)||e.createObjectStore(SETTINGS_STORE,{keyPath:"id"})},a.onsuccess=function(e){db=e.target.result,console.log("Database initialized successfully"),t()},a.onerror=function(e){console.error("Database error:",e.target.error),showStatus("keyStatus","Database initialization failed. Using less secure localStorage instead.","warning"),appSettings.useIndexedDB=!1,t()}});showStatus("keyStatus","Your browser doesn't support secure storage. Using less secure localStorage instead.","warning"),appSettings.useIndexedDB=!1}function switchTab(t){console.log("Switching to tab:",t),tabBtns.forEach(e=>{e.getAttribute("data-tab")===t?e.classList.add("active"):e.classList.remove("active")}),document.getElementById("encryptMessage").value="",document.getElementById("encryptedOutput").value="",document.getElementById("encryptStatus").className="status",document.getElementById("encryptStatus").textContent="",document.getElementById("encryptionKey").value="",document.getElementById("encryptionPassword").value="",document.getElementById("encryptionPasswordGroup").style.display="none",clearEncryptFile(),document.getElementById("encryptedMessage").value="",document.getElementById("decryptedOutput").value="",document.getElementById("decryptStatus").className="status",document.getElementById("decryptStatus").textContent="",document.getElementById("decryptionKey").value="",document.getElementById("decryptionPassword").value="",document.getElementById("decryptionPasswordGroup").style.display="none",clearDecryptFile(),window.decryptedBinaryData=null,document.getElementById("encrypt").classList.remove("active"),document.getElementById("decrypt").classList.remove("active"),document.getElementById("keys").classList.remove("active"),document.getElementById("settings").classList.remove("active"),document.getElementById(t).classList.add("active")}function setLoading(e){loadingOverlay.style.display=e?"flex":"none"}async function loadSettings(){if(appSettings.useIndexedDB&&db)try{var e=await getFromDatabase(SETTINGS_STORE,"app-settings");e&&(appSettings={...DEFAULT_SETTINGS,...e})}catch(e){console.error("Error loading settings from database:",e);try{var t=localStorage.getItem("LemonadeSettings");t&&(appSettings={...DEFAULT_SETTINGS,...JSON.parse(t)})}catch(e){console.error("Error loading settings from localStorage:",e)}}else try{var a=localStorage.getItem("LemonadeSettings");a&&(appSettings={...DEFAULT_SETTINGS,...JSON.parse(a)})}catch(e){console.error("Error loading settings from localStorage:",e)}return PBKDF2_CONFIG.ITERATIONS=appSettings.pbkdf2Iterations,appSettings}function initSettingsUI(){document.getElementById("useIndexedDB").checked=appSettings.useIndexedDB,document.getElementById("sessionOnly").checked=appSettings.sessionOnly,document.getElementById("enforcePwdProtection").checked=appSettings.enforcePwdProtection,document.getElementById("enforceKeyExpiry").checked=appSettings.enforceKeyExpiry,document.getElementById("pbkdf2Iterations").value=appSettings.pbkdf2Iterations}async function saveSettings(){try{appSettings.useIndexedDB=document.getElementById("useIndexedDB").checked,appSettings.sessionOnly=document.getElementById("sessionOnly").checked,appSettings.enforcePwdProtection=document.getElementById("enforcePwdProtection").checked,appSettings.enforceKeyExpiry=document.getElementById("enforceKeyExpiry").checked,appSettings.pbkdf2Iterations=parseInt(document.getElementById("pbkdf2Iterations").value),PBKDF2_CONFIG.ITERATIONS=appSettings.pbkdf2Iterations,appSettings.useIndexedDB&&db?await saveToDatabase(SETTINGS_STORE,{id:"app-settings",...appSettings}):localStorage.setItem("LemonadeSettings",JSON.stringify(appSettings)),showStatus("settingsStatus","Settings saved successfully","success")}catch(e){console.error("Error saving settings:",e),showStatus("settingsStatus","Error saving settings: "+e.message,"error")}}function resetSettings(){confirm("Are you sure you want to reset all settings to defaults?")&&(appSettings={...DEFAULT_SETTINGS},initSettingsUI(),saveSettings())}function updatePasswordStrength(){var e=document.getElementById("keyPassword").value,t=validator.measurePasswordStrength(e),a=document.getElementById("passwordStrength"),r=document.getElementById("passwordFeedback");a.className="password-strength",e?(a.classList.add(t.strengthCategory),r.textContent=t.feedback):r.textContent=""}async function loadKeys(){try{var e,t;keys=[],appSettings.useIndexedDB&&db?(e=await getAllFromDatabase(KEYS_STORE))&&0<e.length&&(keys=e):(t=localStorage.getItem("LemonadeKeys"))&&(keys=JSON.parse(t)),checkExpiredKeys(),updateKeysList(),updateKeySelects()}catch(e){console.error("Error loading keys:",e),showStatus("keyStatus","Error loading keys: "+e.message,"error")}}async function saveKeys(){try{if(appSettings.sessionOnly)console.log("Session-only mode: Keys not saved persistently");else if(appSettings.useIndexedDB&&db){await clearDatabase(KEYS_STORE);for(var e of keys)await saveToDatabase(KEYS_STORE,e)}else localStorage.setItem("LemonadeKeys",JSON.stringify(keys));updateKeysList(),updateKeySelects()}catch(e){console.error("Error saving keys:",e),showStatus("keyStatus","Error saving keys: "+e.message,"error")}}function checkExpiredKeys(){let t=new Date,a=[];keys.forEach(e=>{e.expiry&&new Date(e.expiry)<t&&a.push(e.id)}),0<a.length&&(keys=keys.filter(e=>!a.includes(e.id)),saveKeys(),showStatus("keyStatus",a.length+" expired key(s) removed for security","warning"))}async function generateKey(){try{setLoading(!0);var e,t,a,r=document.getElementById("keyName").value.trim(),n=document.getElementById("keyType").value,s=document.getElementById("keyPassword").value,o=document.getElementById("confirmKeyPassword").value,i=document.getElementById("keyExpiry").value;if(r)if(validator.isValidKeyName(r))if(appSettings.enforcePwdProtection&&!s)showStatus("keyStatus","Password protection is required by your security settings","error");else{if(s){var d=validator.measurePasswordStrength(s);if(d.score<4)return void showStatus("keyStatus","Please use a stronger password: "+d.feedback,"error");if(s!==o)return void showStatus("keyStatus","Passwords do not match","error")}appSettings.enforceKeyExpiry&&!i?showStatus("keyStatus","Key expiration is required by your security settings","error"):(e={id:crypto.randomUUID(),name:r,type:n,created:(new Date).toISOString()},i&&(t=parseInt(i),(a=new Date).setDate(a.getDate()+t),e.expiry=a.toISOString()),("rsa"===n||"rsa-4096"===n||"ecc"===n||"ecc-p384"===n)&&(e.hasPublic=!0,e.hasPrivate=!0,e.pairedKeyId=e.id),"aes"===n?await generateAESKey(e,s):"rsa"===n?await generateRSAKey(e,s,RSA_CONFIG.KEY_SIZE):"rsa-4096"===n?await generateRSAKey(e,s,RSA_CONFIG.KEY_SIZE_4096):"ecc"===n?await generateECCKey(e,s,ECC_CONFIG.CURVE):"ecc-p384"===n&&await generateECCKey(e,s,ECC_CONFIG.CURVE_P384),keys.push(e),await saveKeys(),document.getElementById("keyName").value="",document.getElementById("keyPassword").value="",document.getElementById("confirmKeyPassword").value="",document.getElementById("passwordStrength").className="password-strength",document.getElementById("passwordFeedback").textContent="",showStatus("keyStatus",getKeyTypeDisplay(e)+` key "${r}" generated successfully`,"success"))}else showStatus("keyStatus","Key name can only contain letters, numbers, spaces, and basic punctuation (._-)","error");else showStatus("keyStatus","Please enter a key name","error")}catch(e){console.error("Error generating key:",e),showStatus("keyStatus","Error generating key: "+e.message,"error")}finally{setLoading(!1)}}function getPairedKeyIds(t){if(t.pairedKeyId)return t.pairedKeyId;if(t.hasPrivate&&t.hasPublic)return t.id;if(("rsa"===t.type||"rsa-4096"===t.type||"ecc"===t.type||"ecc-p384"===t.type)&&(t.hasPublic||t.hasPrivate)){var e=keys.filter(e=>e.id!==t.id&&e.type===t.type&&(t.hasPublic&&e.hasPrivate||t.hasPrivate&&e.hasPublic)&&e.publicKeyHash&&t.publicKeyHash&&e.publicKeyHash===t.publicKeyHash);if(0<e.length)return e[0].id}return null}function zeroAllKeys(){var e;0===keys.length?showStatus("keyStatus","No keys to delete","warning"):confirm("WARNING: This will permanently delete ALL your encryption keys. This action CANNOT be undone.\n\nAre you absolutely sure you want to continue?")?(e=keys.length,keys=[],appSettings.useIndexedDB&&db?clearDatabase(KEYS_STORE).then(()=>{console.log("All keys cleared from database")}).catch(e=>{console.error("Error clearing keys from database:",e)}):localStorage.removeItem("LemonadeKeys"),updateKeysList(),updateKeySelects(),showStatus("keyStatus",`All keys (${e}) have been permanently deleted`,"success")):showStatus("keyStatus","Key deletion canceled","info")}async function generateAESKey(e,t){var a=await window.crypto.subtle.generateKey({name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt","decrypt"]),a=await window.crypto.subtle.exportKey("raw",a);e.key=arrayBufferToBase64(a),e.algorithm=AES_CONFIG.MODE,e.length=AES_CONFIG.KEY_LENGTH,t&&await encryptKeyWithPassword(e,t)}async function generateRSAKey(e,t,a){var r=await window.crypto.subtle.generateKey({name:RSA_CONFIG.ALGORITHM,modulusLength:a,publicExponent:new Uint8Array([1,0,1]),hash:RSA_CONFIG.HASH},!0,["encrypt","decrypt"]),n=await window.crypto.subtle.exportKey("spki",r.publicKey),r=await window.crypto.subtle.exportKey("pkcs8",r.privateKey),r=(e.publicKey=arrayBufferToBase64(n),e.privateKey=arrayBufferToBase64(r),e.algorithm=RSA_CONFIG.ALGORITHM,e.length=a,await computeKeyHash(n));e.publicKeyHash=r,t&&await encryptKeyWithPassword(e,t)}async function generateECCKey(e,t,a){var r=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:a},!0,["deriveKey","deriveBits"]),n=await window.crypto.subtle.exportKey("spki",r.publicKey),r=await window.crypto.subtle.exportKey("pkcs8",r.privateKey),r=(e.publicKey=arrayBufferToBase64(n),e.privateKey=arrayBufferToBase64(r),e.algorithm="ECDH",e.curve=a,await computeKeyHash(n));e.publicKeyHash=r,t&&await encryptKeyWithPassword(e,t)}async function computeKeyHash(e){return arrayBufferToBase64(await crypto.subtle.digest("SHA-256",e))}async function encryptKeyWithPassword(e,t){var a,r=window.crypto.getRandomValues(new Uint8Array(16)),t=(e.salt=arrayBufferToBase64(r),await deriveKeyFromPassword(t,r)),r=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH));e.iv=arrayBufferToBase64(r),"aes"===e.type?(a=await encryptWithDerivedKey(t,base64ToArrayBuffer(e.key),r),e.key=arrayBufferToBase64(a)):(a=await encryptWithDerivedKey(t,base64ToArrayBuffer(e.privateKey),r),e.privateKey=arrayBufferToBase64(a)),e.protected=!0}async function decryptKeyWithPassword(e,t){try{if(!e||!t)throw new Error("Key data and password are required");if(!e.salt||!e.iv)throw new Error("Key is missing salt or IV data");var a=await deriveKeyFromPassword(t,base64ToArrayBuffer(e.salt)),r=base64ToArrayBuffer(e.iv),n={...e};if("aes"===e.type){if(!e.key)throw new Error("Missing encrypted key data");var s=await decryptWithDerivedKey(a,base64ToArrayBuffer(e.key),r);n.key=arrayBufferToBase64(s),n._cryptoKey=await importAESKey(s)}else if("rsa"===e.type||"rsa-4096"===e.type){if(!e.privateKey)throw new Error("Missing encrypted private key data");var o=await decryptWithDerivedKey(a,base64ToArrayBuffer(e.privateKey),r);n.privateKey=arrayBufferToBase64(o),n._privateKey=await importRSAPrivateKey(o,e.length||RSA_CONFIG.KEY_SIZE),e.publicKey&&(n._publicKey=await importRSAPublicKey(base64ToArrayBuffer(e.publicKey),e.length||RSA_CONFIG.KEY_SIZE))}else{if("ecc"!==e.type&&"ecc-p384"!==e.type)throw new Error("Unsupported key type: "+e.type);if(!e.privateKey)throw new Error("Missing encrypted private key data");var i=await decryptWithDerivedKey(a,base64ToArrayBuffer(e.privateKey),r);n.privateKey=arrayBufferToBase64(i),n._privateKey=await importECCPrivateKey(i,e.curve||ECC_CONFIG.CURVE),e.publicKey&&(n._publicKey=await importECCPublicKey(base64ToArrayBuffer(e.publicKey),e.curve||ECC_CONFIG.CURVE))}return safeMemory.store(n)}catch(e){throw console.error("Decryption error:",e),new Error("Incorrect password or corrupted private key")}}function updateKeysList(){keysList.innerHTML="",0===keys.length?keysList.innerHTML="<p>No keys available. Generate or import a key to get started.</p>":keys.forEach(e=>{var t=document.createElement("div"),a=(t.className="key-item",getKeyTypeDisplay(e)),r=e.protected?" 🔒":"";let n="";"aes"===e.type?n="":e.hasPrivate&&e.hasPublic?n='<span class="key-pair-badge full">FULL KEY PAIR</span>':e.hasPrivate?n='<span class="key-pair-badge private">PRIVATE KEY</span>':e.hasPublic&&(n='<span class="key-pair-badge public">PUBLIC KEY</span>');var s,o,i=determineKeySecurityLevel(e),i=`<span class="security-badge ${i}">${i.toUpperCase()}</span>`;let d="",c=(e.expiry&&(s=new Date(e.expiry),o=Math.ceil((s-new Date)/864e5),d=`<div class="key-expiry">Expires in ${o} days (${s.toLocaleDateString()})</div>`),"");"aes"===e.type?c+=`<button class="btn-secondary" onclick="exportKey('${e.id}')">Export</button>`:e.hasPublic&&(c+=`<button class="btn-secondary" onclick="exportKey('${e.id}')">Export Public</button>`),"aes"!==e.type&&e.hasPrivate&&(c+=`<button class="btn-secondary private-key-btn" onclick="exportPrivateKey('${e.id}')">Private Key</button>`),c+=`<button class="btn-secondary" onclick="deleteKey('${e.id}')">Delete</button>`,t.innerHTML=`
                    <div class="key-item-content">
                        <div class="key-header">
                            <h3>${validator.sanitizeHTML(e.name)} (${a}${r}) ${i}</h3>
                            ${n}
                        </div>
                        <div class="key-meta">Created: ${new Date(e.created).toLocaleString()}</div>
                        <div class="key-meta">Algorithm: ${e.algorithm||""} ${e.length?e.length+" bits":e.curve||""}</div>
                        ${d}
                        <div class="key-actions">
                            ${c}
                        </div>
                    </div>
                `,keysList.appendChild(t)})}function getKeyTypeDisplay(e){return"aes"===e.type?"AES":"rsa"===e.type?"RSA-2048":"rsa-4096"===e.type?"RSA-4096":"ecc"===e.type?"ECC-P256":"ecc-p384"===e.type?"ECC-P384":e.type.toUpperCase()}function updateKeySelects(){encryptionKeySelect.innerHTML='<option value="">Select a key...</option>',decryptionKeySelect.innerHTML='<option value="">Select a key...</option>',keys.forEach(t=>{if("aes"===t.type||t.hasPublic){var a=document.createElement("option"),r=(a.value=t.id,getKeyTypeDisplay(t)),n=t.protected?" 🔒":"";let e="";"aes"!==t.type&&(e=t.hasPrivate&&t.hasPublic?" [Full Pair]":" [Public]"),a.text=`${t.name} (${r}${e}${n})`,encryptionKeySelect.appendChild(a)}}),keys.forEach(t=>{if("aes"===t.type||t.hasPrivate){var a=document.createElement("option"),r=(a.value=t.id,getKeyTypeDisplay(t)),n=t.protected?" 🔒":"";let e="";"aes"!==t.type&&(e=t.hasPrivate&&t.hasPublic?" [Full Pair]":" [Private]"),a.text=`${t.name} (${r}${e}${n})`,decryptionKeySelect.appendChild(a)}})}function handleEncryptionKeyChange(){let t=encryptionKeySelect.value;var e;t?(e=keys.find(e=>e.id===t))&&(document.getElementById("encryptionPasswordGroup").style.display=e.protected?"block":"none"):document.getElementById("encryptionPasswordGroup").style.display="none"}function handleDecryptionKeyChange(){let t=decryptionKeySelect.value;var e;t?(e=keys.find(e=>e.id===t))&&(document.getElementById("decryptionPasswordGroup").style.display=e.protected?"block":"none"):document.getElementById("decryptionPasswordGroup").style.display="none"}async function encryptMessage(){try{let a,r="";if(encryptFileData)a=encryptFileData,r=generateRandomFileName(6)+".lmn";else{var e=document.getElementById("encryptMessage").value;if(!e)return void showStatus("encryptStatus","Please enter a message or add a file to encrypt","error");a=(new TextEncoder).encode(e)}let t=document.getElementById("encryptionKey").value;var n=document.getElementById("encryptionPassword").value;if(t){setLoading(!0);var s=keys.find(e=>e.id===t);if(s){let e=null,t=s;if(s.protected){if(!n)return void showStatus("encryptStatus","Password required for this key","error");e=await decryptKeyWithPassword(s,n),t=safeMemory.retrieve(e)}var o=await encryptData(a,t),i=(e&&safeMemory.delete(e),encryptFileData&&(o.fileName=encryptFileName,o.fileSize=encryptFileData.byteLength,o.isFile=!0),createEncryptedMessageString(o));document.getElementById("encryptedOutput").value=i,document.getElementById("downloadEncryptedBtn").setAttribute("data-filename",r),showStatus("encryptStatus","Message encrypted successfully","success")}else showStatus("encryptStatus","Key not found","error")}else showStatus("encryptStatus","Please select an encryption key","error")}catch(e){console.error("Encryption error:",e),showStatus("encryptStatus","Encryption error: "+e.message,"error")}finally{document.getElementById("encryptionPassword").value="",setLoading(!1)}}async function encryptWithAES(t,a){try{var r,n=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH));let e;e=a._cryptoKey||(r=base64ToArrayBuffer(a.key),await window.crypto.subtle.importKey("raw",r,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["encrypt"]));var s=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:n,tagLength:AES_CONFIG.TAG_LENGTH},e,t),o={k:a.id,t:(new Date).toISOString(),a:AES_CONFIG.MODE},i=(encryptFileData&&encryptFileName&&(o.f={n:encryptFileName,s:encryptFileData.byteLength}),(new TextEncoder).encode(JSON.stringify(o))),d=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),c=await window.crypto.subtle.generateKey({name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt"]),y=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:d,tagLength:AES_CONFIG.TAG_LENGTH},c,i),l=await window.crypto.subtle.exportKey("raw",c),u=1+d.byteLength+4+l.byteLength+4+y.byteLength+n.byteLength+4+s.byteLength,p=new Uint8Array(u),m=0,w=(p[m++]=3,p.set(d,1),m+=d.byteLength,l.byteLength),g=(p[m++]=w>>24&255,p[m++]=w>>16&255,p[m++]=w>>8&255,p[m++]=255&w,p.set(new Uint8Array(l),m),m+=l.byteLength,y.byteLength),E=(p[m++]=g>>24&255,p[m++]=g>>16&255,p[m++]=g>>8&255,p[m++]=255&g,p.set(new Uint8Array(y),m),m+=y.byteLength,p.set(n,m),m+=n.byteLength,s.byteLength);return p[m++]=E>>24&255,p[m++]=E>>16&255,p[m++]=E>>8&255,p[m++]=255&E,p.set(new Uint8Array(s),m),{version:3,data:arrayBufferToBase64(p.buffer)}}catch(e){throw console.error("AES encryption error:",e),new Error("Encryption failed: "+e.message)}}async function deriveMetadataKey(e,t){var e=await window.crypto.subtle.exportKey("raw",e),a=new Uint8Array(e.byteLength+t.byteLength),e=(a.set(new Uint8Array(e),0),a.set(t,e.byteLength),await window.crypto.subtle.importKey("raw",a,{name:"HKDF"},!1,["deriveKey"]));return window.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:t,info:new Uint8Array([1,2,3,4])},e,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["encrypt","decrypt"])}async function encryptWithRSA(e,t){var a=await window.crypto.subtle.generateKey({name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt","decrypt"]),r=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),e=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:r,tagLength:AES_CONFIG.TAG_LENGTH},a,e),a=await window.crypto.subtle.exportKey("raw",a);let n;n=t._publicKey||await importRSAPublicKey(base64ToArrayBuffer(t.publicKey),t.length||RSA_CONFIG.KEY_SIZE);var a=await window.crypto.subtle.encrypt({name:RSA_CONFIG.ALGORITHM},n,a),t={a:RSA_CONFIG.ALGORITHM+"+"+AES_CONFIG.MODE,k:t.id,t:(new Date).toISOString(),s:t.length||RSA_CONFIG.KEY_SIZE},t=(encryptFileData&&encryptFileName&&(t.f={n:encryptFileName,s:encryptFileData.byteLength}),(new TextEncoder).encode(JSON.stringify(t))),s=await window.crypto.subtle.generateKey({name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt","decrypt"]),o=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),t=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:o,tagLength:AES_CONFIG.TAG_LENGTH},s,t),s=await window.crypto.subtle.exportKey("raw",s),i=Math.floor(64*Math.random())+1,i=window.crypto.getRandomValues(new Uint8Array(i)),d=new Uint8Array(1+o.byteLength+4+s.byteLength+4+t.byteLength+4+a.byteLength+r.byteLength+4+e.byteLength+1+i.byteLength),c=0,o=(d[c++]=o.byteLength,d.set(o,1),c+=o.byteLength,s.byteLength),o=(d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(s),c),c+=s.byteLength,t.byteLength),s=(d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(t),c),c+=t.byteLength,a.byteLength),o=(d[c++]=s>>24&255,d[c++]=s>>16&255,d[c++]=s>>8&255,d[c++]=255&s,d.set(new Uint8Array(a),c),c+=a.byteLength,d.set(r,c),c+=r.byteLength,e.byteLength);return d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(e),c),c+=e.byteLength,d[c++]=i.byteLength,d.set(i,c),{version:2,data:arrayBufferToBase64(d.buffer)}}async function encryptWithECC(e,t){var a=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:t.curve||ECC_CONFIG.CURVE},!0,["deriveKey","deriveBits"]),r=await window.crypto.subtle.exportKey("spki",a.publicKey);let n;n=t._publicKey||await importECCPublicKey(base64ToArrayBuffer(t.publicKey),t.curve||ECC_CONFIG.CURVE);var s=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),a=await window.crypto.subtle.deriveBits({name:"ECDH",public:n},a.privateKey,256),a=await window.crypto.subtle.importKey("raw",a,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["encrypt"]),a=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:s,tagLength:AES_CONFIG.TAG_LENGTH},a,e),e={a:"ECDH+"+AES_CONFIG.MODE,k:t.id,t:(new Date).toISOString(),c:t.curve||ECC_CONFIG.CURVE},t=(encryptFileData&&encryptFileName&&(e.f={n:encryptFileName,s:encryptFileData.byteLength}),(new TextEncoder).encode(JSON.stringify(e))),e=await window.crypto.subtle.generateKey({name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt","decrypt"]),o=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),t=await window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:o,tagLength:AES_CONFIG.TAG_LENGTH},e,t),e=await window.crypto.subtle.exportKey("raw",e),i=Math.floor(64*Math.random())+1,i=window.crypto.getRandomValues(new Uint8Array(i)),d=new Uint8Array(1+o.byteLength+4+e.byteLength+4+t.byteLength+4+r.byteLength+s.byteLength+4+a.byteLength+1+i.byteLength),c=0,o=(d[c++]=o.byteLength,d.set(o,1),c+=o.byteLength,e.byteLength),o=(d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(e),c),c+=e.byteLength,t.byteLength),e=(d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(t),c),c+=t.byteLength,r.byteLength),o=(d[c++]=e>>24&255,d[c++]=e>>16&255,d[c++]=e>>8&255,d[c++]=255&e,d.set(new Uint8Array(r),c),c+=r.byteLength,d.set(s,c),c+=s.byteLength,a.byteLength);return d[c++]=o>>24&255,d[c++]=o>>16&255,d[c++]=o>>8&255,d[c++]=255&o,d.set(new Uint8Array(a),c),c+=a.byteLength,d[c++]=i.byteLength,d.set(i,c),{version:2,data:arrayBufferToBase64(d.buffer)}}async function decryptMessage(){try{let i;var e=document.getElementById("encryptedMessage").value;if(e)if(isValidEncryptedMessage(e)){try{i=parseEncryptedMessage(e)}catch(e){return void showStatus("decryptStatus","Invalid encrypted message data: "+e.message,"error")}let t=document.getElementById("decryptionKey").value;var d=document.getElementById("decryptionPassword").value;if(t){setLoading(!0);var c=keys.find(e=>e.id===t);if(c){let e=null,t=c;if(c.protected){if(!d)return void showStatus("decryptStatus","Password required for this key","error");e=await decryptKeyWithPassword(c,d),t=safeMemory.retrieve(e)}var y,l=await decryptData(i,t);let a,r,n=(r=l.data?(a=l.data,l.metadata):(a=l,null),e&&safeMemory.delete(e),!1),s=null,o=null;!i.version&&i.isFile&&i.fileName?(n=!0,s=i.fileName,o=i.fileSize||a.byteLength):r&&r.f&&(n=!0,s=r.f.n,o=r.f.s||a.byteLength),n?(document.getElementById("decryptedOutput").value=`File: ${s} (${formatFileSize(o)})`,document.getElementById("downloadDecryptedBtn").setAttribute("data-filename",s),document.getElementById("downloadDecryptedBtn").setAttribute("data-binary","true"),window.decryptedBinaryData=a):(y=(new TextDecoder).decode(a),document.getElementById("decryptedOutput").value=y,document.getElementById("downloadDecryptedBtn").setAttribute("data-filename","decrypted.txt"),document.getElementById("downloadDecryptedBtn").setAttribute("data-binary","false"),window.decryptedBinaryData=null),showStatus("decryptStatus","Message decrypted successfully","success")}else showStatus("decryptStatus","Key not found","error")}else showStatus("decryptStatus","Please select a decryption key","error")}else showStatus("decryptStatus","Invalid encrypted message format","error");else showStatus("decryptStatus","Please enter an encrypted message or add an encrypted file","error")}catch(e){console.error("Decryption error:",e),showStatus("decryptStatus","Decryption error: "+e.message,"error")}finally{document.getElementById("decryptionPassword").value="",setLoading(!1)}}async function decryptWithAES(t,a){try{var r=base64ToArrayBuffer(t.data),n=new Uint8Array(r),s=0;if(3!==n[s++])throw new Error("Unsupported data format version");var o,i=n.slice(1,1+AES_CONFIG.IV_LENGTH),d=n[s+=AES_CONFIG.IV_LENGTH]<<24|n[s+1]<<16|n[s+2]<<8|n[s+3],c=(s+=4,n.slice(s,s+d)),y=n[s+=d]<<24|n[s+1]<<16|n[s+2]<<8|n[s+3],l=(s+=4,n.slice(s,s+y)),u=(s+=y,n.slice(s,s+AES_CONFIG.IV_LENGTH)),p=n[s+=AES_CONFIG.IV_LENGTH]<<24|n[s+1]<<16|n[s+2]<<8|n[s+3],m=(s+=4,n.slice(s,s+p)),w=await window.crypto.subtle.importKey("raw",c,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["decrypt"]),g=await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:i,tagLength:AES_CONFIG.TAG_LENGTH},w,l),E=(new TextDecoder).decode(g),h=JSON.parse(E);if(h.k!==a.id)throw new Error("Key ID mismatch - wrong key for this message");let e;return e=a._cryptoKey||(o=base64ToArrayBuffer(a.key),await window.crypto.subtle.importKey("raw",o,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["decrypt"])),{data:await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:u,tagLength:AES_CONFIG.TAG_LENGTH},e,m),metadata:h}}catch(e){throw console.error("AES Decryption error:",e),e instanceof DOMException?new Error(`Decryption failed: ${e.name} - `+(e.message||"Unknown WebCrypto error")):new Error("Decryption failed: "+e.message)}}function updateEncryptionOutput(e){return createEncryptedMessageString(e)}function isValidEncryptedMessage(e){return/@![\s\S]+?!@/.test(e)}function createEncryptedMessageString(e){var t=generateRandomString(2+Math.floor(9*Math.random())),a=generateRandomString(2+Math.floor(9*Math.random()));return t+"@!"+("string"==typeof e.data?e.data.replace(/[\r\n\s]*(.*?)[\r\n\s]*$/s,"$1"):e.data)+"!@"+a}function parseEncryptedMessage(e){e=e.match(/@!([\s\S]+?)!@/);if(e&&e[1])return{version:2,data:e[1].trim()};throw new Error("Invalid encrypted message format")}function updateEncryptionOutput(e){return createEncryptedMessageString(e)}function generateRandomString(t=5){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let e=0;e<t;e++)r+=a.charAt(Math.floor(Math.random()*a.length));return r}function determineKeySecurityLevel(e){let t="low",a=("aes"===e.type||"rsa-4096"===e.type||"ecc-p384"===e.type?t="medium":"rsa"!==e.type&&"ecc"!==e.type||(t="low"),0);e.protected&&(a+=2),"aes"!==e.type&&e.hasPublic&&e.hasPrivate&&(a+=1),e.expiry&&(a+=1);let r;return r="medium"===t?3<=a?"high":1<=a?"medium":"low":4<=a?"high":2<=a?"medium":"low"}async function decryptWithRSA(t,a){if(t.version&&1!==t.version){var r=base64ToArrayBuffer(t.data),r=new Uint8Array(r),n=0,s=r[n++],o=r.slice(1,1+s),s=r[n+=s]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],i=r.slice(n+=4,n+s),d=r[n+=s]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],c=r.slice(n+=4,n+d),d=r[n+=d]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],y=r.slice(n+=4,n+d),d=r.slice(n+=d,n+AES_CONFIG.IV_LENGTH),l=r[n+=AES_CONFIG.IV_LENGTH]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],r=r.slice(n+=4,n+l);let e;e=a._privateKey||await importRSAPrivateKey(base64ToArrayBuffer(a.privateKey),a.length||RSA_CONFIG.KEY_SIZE);n=await window.crypto.subtle.decrypt({name:RSA_CONFIG.ALGORITHM},e,y),l=await window.crypto.subtle.importKey("raw",i,{name:AES_CONFIG.MODE,length:8*s},!1,["decrypt"]),y=await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:o,tagLength:AES_CONFIG.TAG_LENGTH},l,c),i=(new TextDecoder).decode(y),s=JSON.parse(i);if(s.k!==a.id)throw new Error("Key ID mismatch - wrong key for this message");o=await importAESKey(n);return{data:await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:d,tagLength:AES_CONFIG.TAG_LENGTH},o,r),metadata:s}}{l=base64ToArrayBuffer(t.data),c=base64ToArrayBuffer(t.encryptedKey),y=base64ToArrayBuffer(t.iv);let e;e=a._privateKey||await importRSAPrivateKey(base64ToArrayBuffer(a.privateKey),t.keySize||a.length||RSA_CONFIG.KEY_SIZE);i=await importAESKey(await window.crypto.subtle.decrypt({name:RSA_CONFIG.ALGORITHM},e,c));return window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:y,tagLength:AES_CONFIG.TAG_LENGTH},i,l)}}async function decryptWithECC(t,a){if(t.version&&1!==t.version){var r=base64ToArrayBuffer(t.data),r=new Uint8Array(r),n=0,s=r[n++],o=r.slice(1,1+s),s=r[n+=s]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],i=r.slice(n+=4,n+s),d=r[n+=s]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],c=r.slice(n+=4,n+d),d=r[n+=d]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],y=r.slice(n+=4,n+d),d=r.slice(n+=d,n+AES_CONFIG.IV_LENGTH),l=r[n+=AES_CONFIG.IV_LENGTH]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],r=r.slice(n+=4,n+l),n=await importECCPublicKey(y,a.curve||ECC_CONFIG.CURVE);let e;e=a._privateKey||await importECCPrivateKey(base64ToArrayBuffer(a.privateKey),a.curve||ECC_CONFIG.CURVE);l=await window.crypto.subtle.deriveBits({name:"ECDH",public:n},e,256),y=await window.crypto.subtle.importKey("raw",l,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["decrypt"]),n=await window.crypto.subtle.importKey("raw",i,{name:AES_CONFIG.MODE,length:8*s},!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:o,tagLength:AES_CONFIG.TAG_LENGTH},n,c),i=(new TextDecoder).decode(l),s=JSON.parse(i);if(s.k!==a.id)throw new Error("Key ID mismatch - wrong key for this message");return{data:await window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:d,tagLength:AES_CONFIG.TAG_LENGTH},y,r),metadata:s}}{o=base64ToArrayBuffer(t.data),n=base64ToArrayBuffer(t.ephemeralPublicKey),c=base64ToArrayBuffer(t.iv),l=await importECCPublicKey(n,t.curve||ECC_CONFIG.CURVE);let e;e=a._privateKey||await importECCPrivateKey(base64ToArrayBuffer(a.privateKey),t.curve||ECC_CONFIG.CURVE);i=await window.crypto.subtle.deriveKey({name:"ECDH",public:l},e,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["decrypt"]);return window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:c,tagLength:AES_CONFIG.TAG_LENGTH},i,o)}}function downloadEncryptedFile(){var e,t=document.getElementById("encryptedOutput").value;t?(e=document.getElementById("downloadEncryptedBtn").getAttribute("data-filename")||generateRandomFileName(6)+".lmn",downloadBlob(new Blob([t],{type:"application/octet-stream"}),e),showStatus("encryptStatus",`File "${e}" downloaded successfully`,"success")):showStatus("encryptStatus","No encrypted data to download","error")}function downloadDecryptedFile(){if(window.decryptedBinaryData){var e=document.getElementById("downloadDecryptedBtn").getAttribute("data-filename")||"decrypted_file";downloadBlob(new Blob([window.decryptedBinaryData],{type:"application/octet-stream"}),e)}else{e=document.getElementById("decryptedOutput").value;if(!e)return void showStatus("decryptStatus","No decrypted data to download","error");var t=document.getElementById("downloadDecryptedBtn").getAttribute("data-filename")||"decrypted.txt";downloadBlob(new Blob([e],{type:"application/octet-stream"}),t)}showStatus("decryptStatus","File downloaded successfully","success")}function downloadBlob(e,t){var e=URL.createObjectURL(e),a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(e)}function importKey(){createKeyFileInput().click()}async function exportKey(t,e=!1){try{var r=keys.find(e=>e.id===t);if(r){var n="rsa"===r.type||"rsa-4096"===r.type||"ecc"===r.type||"ecc-p384"===r.type;let t=r,a=".lim";if(n&&e){let e="";try{e=await showPasswordModal("Secure Your Private Key","Please enter a password to protect this private key:",!0)}catch(e){return}if(!e&&!confirm("Warning: Exporting a private key without password protection is a security risk. Continue anyway?"))return;if(t={id:r.id,name:r.name,type:r.type,created:r.created,expiry:r.expiry,privateKey:r.privateKey,protected:r.protected,salt:r.salt,iv:r.iv,algorithm:r.algorithm,hasPrivate:!0,hasPublic:!1,pairedKeyId:r.id,publicKeyHash:r.publicKeyHash},"rsa"===r.type||"rsa-4096"===r.type?t.length=r.length:"ecc"!==r.type&&"ecc-p384"!==r.type||(t.curve=r.curve),e){if(r.protected)try{var s=await decryptKeyWithPassword(r,await showPasswordModal("Enter Current Password","Enter the current key password to continue:",!1)),o=safeMemory.retrieve(s,!0);t.privateKey=o.privateKey,t.protected=!1}catch(e){return void showStatus("keyStatus","Export cancelled: "+e.message,"error")}await encryptKeyWithPassword(t,e)}a=".lem"}else n&&!e&&(t={id:r.id,name:r.name,type:r.type,created:r.created,expiry:r.expiry,publicKey:r.publicKey,algorithm:r.algorithm,hasPublic:!0,hasPrivate:!1,pairedKeyId:r.id,publicKeyHash:r.publicKeyHash},"rsa"===r.type||"rsa-4096"===r.type?t.length=r.length:"ecc"!==r.type&&"ecc-p384"!==r.type||(t.curve=r.curve));var i=JSON.stringify(t),d=btoa(i),c=new Blob([d],{type:"application/octet-stream"}),y=URL.createObjectURL(c),l=document.createElement("a"),u=(l.href=y,l.download=""+r.name.replace(/[^a-z0-9]/gi,"_")+a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(y),e?"private key":n?"public key":"key");showStatus("keyStatus",`Key "${r.name}" ${u} exported as ${a} file`,"success")}else alert("Key not found")}catch(e){console.error("Export error:",e),showStatus("keyStatus","Export error: "+e.message,"error")}}async function exportPrivateKey(t){var e=keys.find(e=>e.id===t);e?e.hasPrivate?confirm("WARNING: Exporting a private key is a security risk. Only export private keys if you absolutely need to use them on another device. Do you want to continue?")&&await exportKey(t,!0):showStatus("keyStatus","This key does not have a private key component to export","error"):alert("Key not found")}function createKeyFileInput(){let e=document.getElementById("keyFileInput");return e||((e=document.createElement("input")).type="file",e.id="keyFileInput",e.accept=".lim,.lem",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",handleKeyFileSelect)),e}async function handleKeyFileSelect(e){try{var t=e.target.files;if(t&&0!==t.length){setLoading(!0);var a=t[0];let c=a.name.toLowerCase().endsWith(".lem"),y=a.name.toLowerCase().endsWith(".lim");var r=new FileReader;r.onload=async function(r){try{var n=r.target.result;let t;try{var s=atob(n);t=JSON.parse(s)}catch(e){throw new Error("Invalid key file format")}if(!(t.id&&t.name&&t.type&&t.created))throw new Error("Missing required key properties");if(!validator.isValidKeyName(t.name))throw new Error("Invalid key name format");if("aes"===t.type)t.hasPublic=!0,t.hasPrivate=!0;else{if(t.hasPublic=!!t.publicKey,t.hasPrivate=!!t.privateKey,c&&!t.hasPrivate)throw new Error("This .lem file does not contain a private key");if(y&&!t.hasPublic)throw new Error("This .lim file does not contain a public key")}if(t.hasPrivate&&t.protected){let e="";try{e=await showPasswordModal("Protected Private Key","This private key is password-protected. Please enter the password to import it:",!1)}catch(e){throw new Error("Password is required to import this protected private key")}if(!e)throw new Error("Password is required to import this protected private key");t._importPassword=e}var o,i,d=keys.findIndex(e=>e.id===t.id);let e=!1,a=-1;0<=d?(o=keys[d],(t.hasPrivate&&!o.hasPrivate&&o.hasPublic||t.hasPublic&&!o.hasPublic&&o.hasPrivate)&&(e=!0,a=d)):t.publicKeyHash&&0<=(a=keys.findIndex(e=>e.publicKeyHash===t.publicKeyHash&&e.type===t.type&&(e.hasPrivate&&!e.hasPublic&&t.hasPublic||e.hasPublic&&!e.hasPrivate&&t.hasPrivate)))&&(e=!0),e&&0<=a?confirm(`This appears to be the ${t.hasPrivate?"private":"public"} key part of an existing key. `+"Would you like to merge them into a complete key pair?")?(i=keys[a],t.hasPrivate&&!i.hasPrivate&&(i.privateKey=t.privateKey,i.hasPrivate=!0,t.protected)&&(i.protected=!0,i.salt=t.salt,i.iv=t.iv),t.hasPublic&&!i.hasPublic&&(i.publicKey=t.publicKey,i.hasPublic=!0,t.publicKeyHash)&&(i.publicKeyHash=t.publicKeyHash),i.pairedKeyId=i.id,await saveKeys(),showStatus("keyStatus",`Key "${i.name}" updated with ${t.hasPrivate?"private":"public"} key part. Security level: `+determineKeySecurityLevel(i).toUpperCase(),"success")):(t.id=crypto.randomUUID(),keys.push(t),await saveKeys(),showStatus("keyStatus",`Key "${t.name}" imported as separate key`,"success")):0<=d?(confirm(`A key with name "${t.name}" already exists. Overwrite?`)?keys[d]=t:(t.id=crypto.randomUUID(),keys.push(t)),await saveKeys(),showStatus("keyStatus",`Key "${t.name}" imported successfully`,"success")):(keys.push(t),await saveKeys(),"aes"===t.type?showStatus("keyStatus",`Symmetric key "${t.name}" imported successfully`,"success"):t.hasPrivate&&t.hasPublic?showStatus("keyStatus",`Complete asymmetric key pair "${t.name}" imported successfully`,"success"):t.hasPrivate?showStatus("keyStatus",`Private key "${t.name}" imported successfully`,"success"):showStatus("keyStatus",`Public key "${t.name}" imported successfully`,"success"))}catch(e){console.error("Import error:",e),showStatus("keyStatus","Import error: "+e.message,"error")}finally{setLoading(!1),document.getElementById("keyFileInput").value=""}},r.onerror=function(){setLoading(!1),showStatus("keyStatus","Error reading the key file","error"),document.getElementById("keyFileInput").value=""},r.readAsText(a)}}catch(e){console.error("Import error:",e),showStatus("keyStatus","Import error: "+e.message,"error"),setLoading(!1),document.getElementById("keyFileInput").value=""}}async function exportAllKeys(){try{if(0===keys.length)showStatus("keyStatus","No keys available to export","warning");else{let e="";try{e=await showPasswordModal("Secure Your Key Backup","Please enter a password to protect your key backup. This is highly recommended for security.",!0)}catch(e){return}let t;if(e){var a=JSON.stringify(keys),r=(new TextEncoder).encode(a),n=window.crypto.getRandomValues(new Uint8Array(16)),s=await deriveKeyFromPassword(e,n),o=window.crypto.getRandomValues(new Uint8Array(AES_CONFIG.IV_LENGTH)),i=await encryptWithDerivedKey(s,r,o);t=JSON.stringify({format:"LemonadeProtectedBackup",salt:arrayBufferToBase64(n),iv:arrayBufferToBase64(o),data:arrayBufferToBase64(i)})}else{if(!confirm("WARNING: Exporting keys without a password is not secure. Anyone with access to this file will be able to use your keys. Continue anyway?"))return;t=JSON.stringify(keys)}var d=new Blob([t],{type:"application/octet-stream"}),c=URL.createObjectURL(d),y=document.createElement("a");y.href=c,y.download="Lemonade-state.state",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(c),showStatus("keyStatus","Application state exported successfully","success")}}catch(e){console.error("Export error:",e),showStatus("keyStatus","Export error: "+e.message,"error")}}function createStateFileInput(){let e=document.getElementById("stateFileInput");return e||((e=document.createElement("input")).type="file",e.id="stateFileInput",e.accept=".state,application/octet-stream",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",handleStateFileSelect)),e}async function handleStateFileSelect(e){try{var t,a,r=e.target.files;r&&0!==r.length&&(setLoading(!0),t=r[0],(a=new FileReader).onload=async function(e){try{var a=e.target.result;let t;try{t=JSON.parse(a)}catch(e){throw new Error("Invalid state file format")}if("LemonadeProtectedBackup"===t.format){let e="";try{e=await showPasswordModal("Protected State File","This state file is password-protected. Please enter the password to import:",!1)}catch(e){throw new Error("Password is required to import this protected state file")}if(!e)throw new Error("Password is required to import this protected state file");var r=base64ToArrayBuffer(t.salt),n=base64ToArrayBuffer(t.iv),s=base64ToArrayBuffer(t.data),o=await decryptWithDerivedKey(await deriveKeyFromPassword(e,r),s,n),i=(new TextDecoder).decode(o);t=JSON.parse(i)}if(!Array.isArray(t))throw new Error("Invalid state data format");confirm(`This will import ${t.length} keys into your application. Continue?`)&&(keys=t,await saveKeys(),showStatus("keyStatus",`Application state with ${t.length} keys imported successfully`,"success"))}catch(e){console.error("State import error:",e),showStatus("keyStatus","State import error: "+e.message,"error")}finally{setLoading(!1),document.getElementById("stateFileInput").value=""}},a.onerror=function(){setLoading(!1),showStatus("keyStatus","Error reading the state file","error"),document.getElementById("stateFileInput").value=""},a.readAsText(t))}catch(e){console.error("State import error:",e),showStatus("keyStatus","State import error: "+e.message,"error"),setLoading(!1),document.getElementById("stateFileInput").value=""}}function importState(){createStateFileInput().click()}async function secureClipboardCopy(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.log("Modern clipboard API failed:",e),!1}}function deleteKey(t){var e=keys.find(e=>e.id===t);e?window.confirm(`Are you sure you want to delete the key "${e.name}"? This action cannot be undone.`)&&(keys=keys.filter(e=>e.id!==t),saveKeys(),showStatus("keyStatus",`Key "${e.name}" deleted successfully`,"success")):alert("Key not found")}function showStatus(e,t,a){let r=document.getElementById(e);r.textContent=validator.sanitizeHTML(t),r.className="status "+a,setTimeout(()=>{r.textContent===validator.sanitizeHTML(t)&&(r.className="status")},1e4)}document.addEventListener("DOMContentLoaded",async()=>{document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.getAttribute("data-tab");console.log("Tab button clicked:",e),switchTab(e)})}),document.getElementById("darkMode").addEventListener("change",toggleDarkMode),"true"===localStorage.getItem("LemonadeDarkMode")&&(document.getElementById("darkMode").checked=!0,document.body.classList.add("dark-mode")),document.getElementById("clearEncryptMessageBtn").addEventListener("click",()=>{clearEncryptFile()}),document.getElementById("clearEncryptedMessageBtn").addEventListener("click",()=>{clearDecryptFile()}),await initDatabase(),await loadSettings(),initSettingsUI(),await loadKeys(),document.getElementById("keyPassword").addEventListener("input",updatePasswordStrength),document.getElementById("encryptBtn").addEventListener("click",encryptMessage),document.getElementById("decryptBtn").addEventListener("click",decryptMessage),document.getElementById("generateKeyBtn").addEventListener("click",generateKey),document.getElementById("copyEncryptedBtn").addEventListener("click",()=>copyToClipboard("encryptedOutput","encryptStatus")),document.getElementById("copyDecryptedBtn").addEventListener("click",()=>copyToClipboard("decryptedOutput","decryptStatus")),document.getElementById("clearEncryptBtn").addEventListener("click",()=>{document.getElementById("encryptMessage").value="",document.getElementById("encryptedOutput").value="",document.getElementById("encryptStatus").className="status",document.getElementById("encryptStatus").textContent="",clearEncryptFile()}),document.getElementById("clearDecryptBtn").addEventListener("click",()=>{document.getElementById("encryptedMessage").value="",document.getElementById("decryptedOutput").value="",document.getElementById("decryptStatus").className="status",document.getElementById("decryptStatus").textContent="",clearDecryptFile(),window.decryptedBinaryData=null}),document.getElementById("importKeyBtn").addEventListener("click",importKey),document.getElementById("exportAllKeysBtn").addEventListener("click",exportAllKeys),document.getElementById("importStateBtn").addEventListener("click",importState),document.getElementById("saveSettingsBtn").addEventListener("click",saveSettings),document.getElementById("resetSettingsBtn").addEventListener("click",resetSettings),document.getElementById("zeroKeysBtn").addEventListener("click",zeroAllKeys),encryptionKeySelect.addEventListener("change",handleEncryptionKeyChange),decryptionKeySelect.addEventListener("change",handleDecryptionKeyChange)});let passwordModalCallback=null,passwordModalResolve=null,passwordModalReject=null;function showPasswordModal(d,c,y=!1){return new Promise((e,t)=>{var a=document.getElementById("passwordModal"),r=document.getElementById("passwordModalTitle"),n=document.getElementById("passwordModalMessage");let s=document.getElementById("passwordModalInput");var o=document.getElementById("passwordModalStrength"),i=document.getElementById("passwordModalFeedback");r.textContent=d,n.textContent=c,s.value="",o.className="password-strength",i.textContent="",o.style.display=y?"block":"none",i.style.display=y?"block":"none",passwordModalResolve=e,passwordModalReject=t,a.style.display="flex",setTimeout(()=>{s.focus()},100)})}function confirmPasswordModal(){var e=document.getElementById("passwordModalInput").value,t=document.getElementById("passwordModalStrength"),a=document.getElementById("passwordModalFeedback");t.className="password-strength",a.textContent="",document.getElementById("passwordModal").style.display="none",passwordModalResolve&&(passwordModalResolve(e),passwordModalResolve=null,passwordModalReject=null)}function cancelPasswordModal(){var e=document.getElementById("passwordModalInput"),t=document.getElementById("passwordModalStrength"),a=document.getElementById("passwordModalFeedback");e.value="",t.className="password-strength",a.textContent="",document.getElementById("passwordModal").style.display="none",passwordModalReject&&(passwordModalReject(new Error("Password entry cancelled")),passwordModalResolve=null,passwordModalReject=null)}function updateModalPasswordStrength(){var e=document.getElementById("passwordModalInput").value,t=validator.measurePasswordStrength(e),a=document.getElementById("passwordModalStrength"),r=document.getElementById("passwordModalFeedback");a.className="password-strength",e?(a.classList.add(t.strengthCategory),r.textContent=t.feedback):r.textContent=""}async function copyToClipboard(e,t){var a=document.getElementById(e).value;a?await secureClipboardCopy(a)?(showStatus(t,"Copied to clipboard","success"),appSettings.clearClipboard&&scheduleClipboardClear()):(showStatus(t,"Unable to copy automatically. Please select the text and press Ctrl+C (or ⌘+C) to copy manually.","warning"),(a=document.getElementById(e)).focus(),a.select()):showStatus(t,"Nothing to copy","error")}function toggleDarkMode(){var e=document.getElementById("darkMode").checked;e?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("LemonadeDarkMode",e)}function arrayBufferToBase64(e){var t=new Uint8Array(e);let a="";for(let e=0;e<t.byteLength;e++)a+=String.fromCharCode(t[e]);return btoa(a)}function base64ToArrayBuffer(e){try{var t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a.buffer}catch(e){throw console.error("Base64 decoding error:",e),new Error("Invalid base64 data: "+e.message)}}async function encryptData(e,t){if("aes"===t.type)return encryptWithAES(e,t);if("rsa"===t.type||"rsa-4096"===t.type)return encryptWithRSA(e,t);if("ecc"===t.type||"ecc-p384"===t.type)return encryptWithECC(e,t);throw new Error("Unsupported key type")}async function decryptData(e,t){if(2===e.version){if("aes"===t.type)return decryptWithAES(e,t);if("rsa"===t.type||"rsa-4096"===t.type)return decryptWithRSA(e,t);if("ecc"===t.type||"ecc-p384"===t.type)return decryptWithECC(e,t)}if(e.algorithm===AES_CONFIG.MODE)return decryptWithAES(e,t);if(e.algorithm===RSA_CONFIG.ALGORITHM+"+"+AES_CONFIG.MODE||"RSA-OAEP+AES-GCM"===e.algorithm)return decryptWithRSA(e,t);if(e.algorithm==="ECDH+"+AES_CONFIG.MODE||"ECDH+AES-GCM"===e.algorithm)return decryptWithECC(e,t);throw new Error("Unsupported encryption algorithm: "+e.algorithm)}async function deriveKeyFromPassword(e,t){e=(new TextEncoder).encode(e),e=await window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:PBKDF2_CONFIG.ITERATIONS,hash:PBKDF2_CONFIG.HASH},e,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!0,["encrypt","decrypt"])}async function encryptWithDerivedKey(e,t,a){return window.crypto.subtle.encrypt({name:AES_CONFIG.MODE,iv:a,tagLength:AES_CONFIG.TAG_LENGTH},e,t)}async function decryptWithDerivedKey(e,t,a){return window.crypto.subtle.decrypt({name:AES_CONFIG.MODE,iv:a,tagLength:AES_CONFIG.TAG_LENGTH},e,t)}async function importAESKey(e){return window.crypto.subtle.importKey("raw",e,{name:AES_CONFIG.MODE,length:AES_CONFIG.KEY_LENGTH},!1,["encrypt","decrypt"])}async function importRSAPublicKey(e,t){return window.crypto.subtle.importKey("spki",e,{name:RSA_CONFIG.ALGORITHM,hash:RSA_CONFIG.HASH},!1,["encrypt"])}async function importRSAPrivateKey(e,t){return window.crypto.subtle.importKey("pkcs8",e,{name:RSA_CONFIG.ALGORITHM,hash:RSA_CONFIG.HASH},!1,["decrypt"])}async function importECCPublicKey(e,t){return window.crypto.subtle.importKey("spki",e,{name:"ECDH",namedCurve:t},!1,[])}async function importECCPrivateKey(e,t){return window.crypto.subtle.importKey("pkcs8",e,{name:"ECDH",namedCurve:t},!1,["deriveKey","deriveBits"])}async function saveToDatabase(r,n){return new Promise((t,a)=>{if(db){let e=db.transaction(r,"readwrite").objectStore(r).put(n);e.onsuccess=()=>t(),e.onerror=()=>a(e.error)}else a(new Error("Database not initialized"))})}async function getFromDatabase(r,n){return new Promise((t,a)=>{if(db){let e=db.transaction(r,"readonly").objectStore(r).get(n);e.onsuccess=()=>t(e.result),e.onerror=()=>a(e.error)}else a(new Error("Database not initialized"))})}async function getAllFromDatabase(r){return new Promise((t,a)=>{if(db){let e=db.transaction(r,"readonly").objectStore(r).getAll();e.onsuccess=()=>t(e.result),e.onerror=()=>a(e.error)}else a(new Error("Database not initialized"))})}async function clearDatabase(r){return new Promise((t,a)=>{if(db){let e=db.transaction(r,"readwrite").objectStore(r).clear();e.onsuccess=()=>t(),e.onerror=()=>a(e.error)}else a(new Error("Database not initialized"))})}window.exportKey=exportKey,window.exportPrivateKey=exportPrivateKey,window.deleteKey=deleteKey;let deferredPrompt,installBtn=document.getElementById("installBtn"),installContainer=document.getElementById("installContainer"),installStatus=document.getElementById("installStatus"),encryptFileData=(installBtn&&(installBtn.disabled=!0),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,installBtn&&(installBtn.disabled=!1,(e=installContainer.querySelector(".install-note"))&&(e.style.display="none"),showStatus("installStatus","Installation is now available!","success"))}),installBtn&&installBtn.addEventListener("click",async()=>{var e;deferredPrompt?(deferredPrompt.prompt(),e=(await deferredPrompt.userChoice).outcome,console.log("User response to install prompt: "+e),"accepted"===e?showStatus("installStatus","Lemonade has been installed successfully!","success"):showStatus("installStatus","Installation was canceled","warning"),deferredPrompt=null,installBtn.disabled=!0):showStatus("installStatus","Installation not available in this browser or app is already installed","warning")}),window.addEventListener("appinstalled",()=>{console.log("Lemonade was installed"),deferredPrompt=null,installBtn&&(installBtn.disabled=!0),showStatus("installStatus","Lemonade has been installed successfully!","success")}),"serviceWorker"in navigator&&("https:"===window.location.protocol||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)?window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("Service Worker registered with scope:",e.scope)}).catch(function(e){console.error("Service Worker registration failed:",e),showStatus("installStatus","Service Worker registration failed. PWA features unavailable.","warning")})}):(console.log("Service Workers not supported or not in secure context"),installStatus&&("file:"===window.location.protocol?showStatus("installStatus","PWA installation requires HTTPS. You are viewing this file locally.","warning"):showStatus("installStatus","Your browser does not support PWA installation features.","warning"))),window.matchMedia("(display-mode: standalone)").matches&&(console.log("App is already running in standalone mode (installed)"),installStatus)&&showStatus("installStatus","Lemonade is running as an installed app","success"),null),encryptFileName="",decryptFileData=null,decryptFileName="";function handleEncryptFileSelect(e){if(0!==e.length){let t=e[0];encryptFileName=t.name;e=new FileReader;e.onload=function(e){encryptFileData=e.target.result,document.getElementById("encryptMessage").value=`File: ${encryptFileName} (${formatFileSize(t.size)})`,document.getElementById("encryptFileInfo").style.display="flex",document.getElementById("encryptFileName").textContent=encryptFileName},e.readAsArrayBuffer(t)}}function handleDecryptFileSelect(e){var t;0!==e.length&&(e=e[0],decryptFileName=e.name,(t=new FileReader).onload=function(e){e=e.target.result;e.includes("@!")&&e.includes("!@")?(document.getElementById("encryptedMessage").value=e,decryptFileData=null,document.getElementById("decryptFileInfo").style.display="flex",document.getElementById("decryptFileName").textContent=decryptFileName,showStatus("decryptStatus","Encrypted file loaded successfully.","success")):(showStatus("decryptStatus","This file is not in Lemonade encrypted format. Try again.","error"),document.getElementById("decryptFileInfo").style.display="none")},t.onerror=function(){showStatus("decryptStatus","Unable to read the file as a Lemonade encrypted format.","error")},t.readAsText(e))}function clearEncryptFile(){encryptFileData=null,encryptFileName="",document.getElementById("encryptMessage").value="",document.getElementById("encryptFileInfo").style.display="none",document.getElementById("encryptFileInput").value=""}function clearDecryptFile(){decryptFileData=null,decryptFileName="",document.getElementById("encryptedMessage").value="",document.getElementById("decryptFileInfo").style.display="none",document.getElementById("decryptFileInput").value=""}function formatFileSize(e){var t;return 0===e?"0 Bytes":(t=Math.floor(Math.log(e)/Math.log(1024)),parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t])}function generateRandomFileName(t=6){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let e=0;e<t;e++)r+=a.charAt(Math.floor(Math.random()*a.length));return r}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("encryptFileInput");var t=document.getElementById("encryptBrowseBtn"),a=(document.getElementById("encryptFileInfo"),document.getElementById("encryptFileName"),document.getElementById("removeEncryptFile"));let r=document.getElementById("decryptFileInput");var n=document.getElementById("decryptBrowseBtn"),s=(document.getElementById("decryptFileInfo"),document.getElementById("decryptFileName"),document.getElementById("removeDecryptFile")),o=document.getElementById("downloadEncryptedBtn"),i=document.getElementById("downloadDecryptedBtn");t.addEventListener("click",()=>{e.click()}),e.addEventListener("change",e=>{handleEncryptFileSelect(e.target.files)}),a.addEventListener("click",()=>{clearEncryptFile()}),n.addEventListener("click",()=>{r.click()}),r.addEventListener("change",e=>{handleDecryptFileSelect(e.target.files)}),s.addEventListener("click",()=>{clearDecryptFile()}),createKeyFileInput(),o.addEventListener("click",downloadEncryptedFile),i.addEventListener("click",downloadDecryptedFile),document.getElementById("encryptBtn").addEventListener("click",function(){window.decryptedBinaryData=null}),document.getElementById("passwordModalConfirm").addEventListener("click",confirmPasswordModal),document.getElementById("passwordModalCancel").addEventListener("click",cancelPasswordModal),document.getElementById("passwordModalInput").addEventListener("input",updateModalPasswordStrength),document.getElementById("passwordModalInput").addEventListener("keypress",function(e){"Enter"===e.key&&confirmPasswordModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&"flex"===document.getElementById("passwordModal").style.display&&cancelPasswordModal()})})</script><div id="passwordModal" class="modal"><div class="modal-content"><h3 id="passwordModalTitle">Enter Password</h3><p id="passwordModalMessage">Please enter a password to continue:</p><div class="form-group"><input type="password" id="passwordModalInput" placeholder="Enter password"><div id="passwordModalStrength" class="password-strength"></div><div id="passwordModalFeedback" class="password-feedback"></div></div><div class="btn-group"><button id="passwordModalConfirm" class="btn-primary">Confirm</button> <button id="passwordModalCancel" class="btn-secondary">Cancel</button></div></div></div></body></html>
